# Copyright 2013 Jakob Nixdorf <flocke@shadowice.org>
# Distributed under the terms of the GNU General Public License v2

require lua flag-o-matic

SUMMARY="Lua bindings for gnome/gobject using gobject-introspection library"

HOMEPAGE="https://github.com/pavouk/lgi"
DOWNLOADS="https://github.com/pavouk/lgi/archive/${PV}.tar.gz -> ${PNV}.tar.gz"
BUGS_TO="flocke@shadowice.org"

LICENCES="MIT"
SLOT="0"
PLATFORMS="~amd64"
MYOPTIONS=""

DEPENDENCIES="
    build:
        dev-util/pkg-config
    build+run:
        dev-lang/lua[>=5.1]
        dev-libs/glib
        dev-libs/libffi
        gnome-desktop/gobject-introspection
"

lua_version

DEFAULT_SRC_COMPILE_PARAMS=( LUA_CFLAGS=-I/usr/include/lua${LUAVER} )
DEFAULT_SRC_INSTALL_PARAMS=( PREFIX=/usr LUA_VERSION=${LUAVER} LUA_LIBDIR=/usr/${LIBDIR}/lua/${LUAVER} )

src_prepare() {
    default

    # disable some tests (they want to access the Xorg server -> access violation in sydbox)
    sed -i \
        -e "s|'gtk.lua',|--'gtk.lua',|" \
        -e "s|'gobject.lua',|--'gobject.lua',|" \
        tests/test.lua
}
